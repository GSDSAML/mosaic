(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[655],{223:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/annotation",function(){return t(8614)}])},9427:function(e,n,t){"use strict";t.d(n,{Z:function(){return PostComment}});var a=t(1309),i=t(5893),s=t(7294),o=t(5121),r=t(7904);function PostComment(e){var n=e.user,t=e.pid,c=e.aid,l=e.type,d=e.onNewComment,u=(0,a._)((0,s.useState)(""),2),m=u[0],f=u[1];return(0,i.jsx)("form",{className:"comment-form inline-items",onSubmit:function(e){e.preventDefault()},children:(0,i.jsxs)("div",{className:"comment-form-container post__author author vcard inline-items",children:["performance"!=l?(0,i.jsx)(i.Fragment,{children:n&&n.avatar?(0,i.jsx)("img",{loading:"lazy",src:n.avatar,alt:"author",width:"36",height:"36"}):(0,i.jsx)("img",{loading:"lazy",src:"img/dalle_avatar.png",alt:"author",width:"36",height:"36"})}):(0,i.jsx)(i.Fragment,{}),(0,i.jsxs)("div",{className:"comment-form-item form-group is-empty",children:[(0,i.jsx)("textarea",{name:"comment",value:m,className:"comment-form-area form-control",placeholder:"Write a comment...",onChange:function(e){f(e.target.value)}}),(0,i.jsx)("span",{className:"material-input"})]}),(0,i.jsx)("button",{className:"comment-form-item btn btn-md-2 btn-primary",onClick:function(){var e=(0,r.LH)(),a="",i=null;l&&"performance"==l?(a=e+"/api/text_comment",i={user_id:n.uid,annotation_id:c,content:m}):(a=e+"/api/comment_post",i={pid:t,user_id:n.uid,content:m});var s=(0,r.KU)();(0,o.Z)({method:"POST",url:a,data:i,headers:{Authorization:"Bearer ".concat(s)}}).then(function(e){f(""),d&&d(m)}).catch(function(e){console.log(e)})},children:"Post Comment"})]})})}},8345:function(e,n,t){"use strict";t.d(n,{Z:function(){return ListPostComment}});var a=t(1309);t(4586);var i=t(5893),s=t(5121),o=t(7904),r=t(8878),c=t(7294);function ListPostComment(e){var n=e.pid,t=e.userId,l=e.type,d=e.needCommentRefresh,u=e.setNeedCommentRefresh,m=(0,a._)((0,c.useState)("en"),2),f=m[0],h=m[1],v=(0,a._)((0,c.useState)([]),2),p=v[0],x=v[1],g=(0,a._)((0,c.useState)({}),2),j=(g[0],g[1]),load_comments=function(){var e=(0,o.LH)(),a="",i=null;l&&"performance"==l?(a=e+"/api/list_text_comment",i={annotation_id:n,user_id:t}):(a=e+"/api/list_post_comment",i={pid:n}),(0,s.Z)({method:"POST",url:a,data:i}).then(function(e){var n=e.data;n.comments&&x(n.comments)}).catch(function(e){console.log(e)})},deleteComment=function(e){var n=e.cid;(0,r.$s)(n,l,function(){x(p.filter(function(e){return e.cid!==n}))})};return(0,c.useEffect)(function(){h((0,o.G3)()),j((0,o.PR)()),load_comments()},[]),(0,c.useEffect)(function(){d&&(load_comments(),u(!1))},[d]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("ul",{className:"comments-list",children:p.map(function(e,n){return(0,i.jsxs)("li",{className:"comment-item "+("performance"==l?"performance-comment-item":""),children:[(0,i.jsxs)("div",{className:"post__author author vcard inline-items",children:[l&&"performance"==l?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)("img",{loading:"lazy",src:e.avatar,width:"36",height:"36",alt:"author"}),(0,i.jsxs)("div",{className:"author-date",children:[(0,i.jsx)("a",{className:"h6 post__author-name fn",href:"/profile?uid="+e.user_id,children:e.fullname}),(0,i.jsx)("div",{className:"post__date",children:(0,i.jsx)("time",{className:"published",dateTime:e.updated_at,children:e.updated_at})})]}),(0,i.jsxs)("div",{className:"more",children:[(0,i.jsx)("svg",{className:"olymp-three-dots-icon",children:(0,i.jsx)("use",{xlinkHref:"#olymp-three-dots-icon"})}),(0,i.jsx)("ul",{className:"more-dropdown",children:(0,i.jsx)("li",{children:(0,i.jsxs)("a",{onClick:function(){return deleteComment(e)},children:[(0,i.jsx)("i",{className:"fa fa-trash"}),"\xa0",(0,o.id)(f,"delete_comment")]})})})]})]}),(0,i.jsx)("p",{children:e.content})]},e.cid)})}),(0,i.jsxs)("a",{className:"more-comments",onClick:function(){},children:[(0,o.id)(f,"view_more_comments")," ",(0,i.jsx)("span",{children:"+"})]})]})}},8614:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return Annotation}});var a=t(2253),i=t(4932),s=t(1309),o=t(4586),r=t(5893),c=t(7294),l=t(9332),d=t(1163),u=t.n(d),m=t(1664),f=t.n(m),h=t(5766),v=t(9806),p=t(9427),x=t(7904),g=t(2341),j=t(8878),w=t(8345),_=t(1010),N=t(7582),b=t(5121),y=t(6180);function SimpleAudioPlayer(e){var n=e.url;return(0,r.jsx)(y.Z,{src:n})}t(3692);var S=t(2968);function VoiceRecorder(e){var n=e.isShow,t=e.closePopup,a=e.onFinish,i=(0,S.I)();return(0,r.jsx)("div",{className:"modal fade voice-recorder "+(n?"show":""),children:(0,r.jsx)("div",{className:"modal-dialog window-popup",role:"document",children:(0,r.jsxs)("div",{className:"modal-content",children:[(0,r.jsx)("a",{className:"close icon-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:function(){i.stopRecording(),t()},children:(0,r.jsx)("svg",{className:"olymp-close-icon",children:(0,r.jsx)("use",{xlinkHref:"#olymp-close-icon"})})}),(0,r.jsx)("div",{className:"modal-body",children:(0,r.jsx)(S.h,{onRecordingComplete:a,audioTrackConstraints:{noiseSuppression:!0,echoCancellation:!0},downloadOnSavePress:!1,downloadFileExtension:"wav"})})]})})})}var voice_comment=function(e){var n,t,o=e.user,l=(e.pid,e.aid),d=e.enable,u=(0,s._)((0,c.useState)("en"),2),m=u[0],f=u[1],h=(0,c.useRef)(),v=(0,s._)((0,c.useState)(25),2),p=v[0];v[1];var g=(0,s._)((0,c.useState)(1),2),w=g[0];g[1];var y=(0,s._)((0,c.useState)({name:"",short_name:""}),2),S=y[0],k=y[1],C=(0,s._)((0,c.useState)(null),2),P=C[0],I=C[1],M=(0,s._)((0,c.useState)({annotation_id:l,type:0,path:""}),2),T=M[0],A=M[1],E=(0,s._)((0,c.useState)([]),2),L=E[0],R=E[1],B=(0,s._)((0,c.useState)(!1),2),F=B[0],D=B[1],H=(n=(0,_._)(function(e){var n;return(0,N.Jh)(this,function(t){return(n=e.target.files[0]).name.includes(".mid")||n.name.includes(".mp3")||n.name.includes(".wav")||n.name.includes(".m4a")||n.name.includes(".midi")?(k({name:n.name,short_name:n.name}),I(n)):alert((0,x.id)(m,file_acceptance_notice)),[2]})}),function(e){return n.apply(this,arguments)}),processBeforeUpload=function(e){var n=localStorage.getItem("backend_url"),t=new FormData;t.append("file",P,S.name),b.Z.post(n+"/api/upload_audio",t).then(function(n){var t=n.data;t.path?e(t.path):alert((0,x.id)(m,"error_upload_file"))})},loadList=function(){(0,j.Ns)(l,o.uid,p,w,function(e){R(e.comments),console.log(e.comments)})},O=(t=(0,_._)(function(e){var n,t,a;return(0,N.Jh)(this,function(i){switch(i.label){case 0:return[4,fetch(e.path)];case 1:return[4,i.sent().blob()];case 2:return n=i.sent(),t=window.URL.createObjectURL(n),(a=document.createElement("a")).href=t,a.download="test.mid",document.body.appendChild(a),a.click(),a.remove(),[2]}})}),function(e){return t.apply(this,arguments)});return(0,c.useEffect)(function(){f((0,x.G3)()),loadList()},[]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("form",{className:"performance-form",onSubmit:function(e){e.preventDefault()},children:[(0,r.jsx)("ul",{className:"voice-list",onMouseDown:function(e){e.stopPropagation()},children:L.length?(0,r.jsx)(r.Fragment,{children:L.map(function(e,n){return(0,r.jsxs)("li",{className:"voice-list-item",onClick:function(){"MIDI"!=(0,x.JB)(e.path)?R(L.map(function(e,t){return t===n?(0,i._)((0,a._)({},e),{audio:!e.audio}):e})):O(e)},children:[(0,r.jsxs)("div",{className:"voice-list-item-content flex",children:[(0,r.jsxs)("div",{className:"voice-list-item-text",children:["Comment on ",e.updated_at]}),(0,r.jsx)("div",{children:e.audio?(0,r.jsx)("i",{className:"fa fa-chevron-down"}):(0,r.jsx)("i",{className:"fa fa-chevron-right"})})]}),e.audio&&(0,r.jsx)("div",{style:{marginTop:"10px"},children:(0,r.jsx)(SimpleAudioPlayer,{url:e.path})})]},e.cid)})}):(0,r.jsx)("li",{className:"voice-list-item",style:{textAlign:"center",background:"none"},children:(0,x.id)(m,"no_voice_comment")})}),d&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"performance-form-content "+(S.name?"show":""),children:(0,r.jsxs)("div",{className:"form-group upload-result",children:[(0,r.jsxs)("div",{className:"upload-result-text",children:[(0,x.id)(m,"your_file_is")," ",(0,r.jsxs)("b",{children:['"',S.name,'"']})]}),(0,r.jsx)("a",{className:"inline-items",onClick:function(){h.current.value="",k((0,i._)((0,a._)({},S),{name:"",short_name:""})),I(null)},children:(0,r.jsx)("svg",{className:"olymp-status-icon",children:(0,r.jsx)("use",{xlinkHref:"#olymp-close-icon"})})})]})}),(0,r.jsxs)("div",{className:"add-options-message add-options-message_both recording-bottom",children:[(0,r.jsxs)("div",{className:"flex recording-action",children:[(0,r.jsxs)("div",{className:"inline-flex",children:[(0,r.jsx)("button",{className:"btn btn-outline-primary",onClick:function(){h.current.click()},children:(0,r.jsx)("i",{className:"fa fa-file-audio"})}),(0,r.jsx)("input",{type:"file",className:"file-upload__input",ref:h,onChange:H,accept:".mid, .midi, .mp3, .wav, .m4a"})]}),(0,r.jsx)("div",{className:"inline-flex",children:(0,r.jsx)("button",{className:"btn btn-outline-primary",onClick:function(){D(!0)},children:(0,r.jsx)("i",{className:"fa fa-microphone"})})})]}),(0,r.jsxs)("div",{className:"recording-upload-container",children:[(0,r.jsx)("fieldset",{className:"form-group",style:{marginBottom:0},children:(0,r.jsxs)("select",{className:"form-select",value:T.type,onChange:function(e){A((0,i._)((0,a._)({},T),{type:e.target.value}))},children:[(0,r.jsx)("option",{value:"0",children:(0,x.id)(m,"comment")}),(0,r.jsx)("option",{value:"1",children:(0,x.id)(m,"ideal")})]})}),(0,r.jsxs)("button",{className:"btn btn-primary btn-md-2",onClick:function(){processBeforeUpload(function(e){var n=(0,a._)({},T);n.path=e,(0,j.h6)(n,function(e){e.message&&(alert("Success!"),k({name:"",short_name:""}),loadList())})})},children:[(0,r.jsx)("i",{className:"fa fa-upload"}),"\xa0",(0,x.id)(m,"upload")]})]})]})]})]}),(0,r.jsx)(VoiceRecorder,{isShow:F,closePopup:function(){D(!1)},onFinish:function(e){var n="Recording_"+(0,x.Xn)()+".wav";I(e),k({name:n,short_name:n}),D(!1)}})]})};function StarMetric(e){var n=e.value,t=e.id,a=e.selectAction,i=e.style,s=e.enable,l=(0,c.useRef)(),getChildren=function(){return l.current.querySelectorAll(".star-button")},handleHoverEnter=function(e){if(s)for(var n=getChildren(),t=0;t<n.length;t++)t<=e&&n[t].classList.add("hovered")},handleHoverLeave=function(){for(var e=getChildren(),n=0;n<e.length;n++)e[n].classList.remove("hovered")},handleClick=function(e){a&&(e+1==n?(a(0),handleHoverLeave()):a(e+1))};return(0,r.jsx)("div",{className:"star-rating",id:t,ref:l,children:(0,o._)([,,,,,]).map(function(e,a){var s=a<<1,o=s+1;return(0,r.jsxs)(c.Fragment,{children:[(0,r.jsx)("button",{type:"button",className:"star-button half-left "+(n&&n>s?"selected":""),onMouseEnter:function(){return handleHoverEnter(s)},onMouseLeave:function(){return handleHoverLeave()},onClick:function(){handleClick(s)},style:i}),(0,r.jsx)("button",{type:"button",className:"star-button half-right "+(n&&n>o?"selected":""),onMouseEnter:function(){return handleHoverEnter(o)},onMouseLeave:function(){return handleHoverLeave()},onClick:function(){handleClick(o)},style:i})]},t+a)})})}function Level2Scale(e){var n=e.score,t=(e.parentId,e.id),a=e.enable,i=e.labels,o=e.onChange,l=(0,s._)((0,c.useState)("en"),2),d=l[0],u=l[1],m=(0,s._)((0,c.useState)({observation:0,suggestion:0}),2),f=m[0],h=m[1],encode=function(e,n){return e<<4|n},changeHandler=function(e){if(a){if(0==f.observation||0!=f.suggestion)o(t,encode(0,e));else if(0!=f.observation){var n=f.observation;f.observation==e&&(e=0,n=0),o(t,encode(e,n))}}};return(0,c.useEffect)(function(){var e=n>>4;h({observation:15&n,suggestion:e})},[n]),(0,c.useEffect)(function(){u((0,x.G3)())},[]),(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(c.Fragment,{children:[(0,r.jsxs)("div",{className:"annotation-item-sub-title",children:[(0,r.jsx)("div",{className:"inline-flex",children:i[0]}),(0,r.jsxs)("div",{className:"fix-pos",children:[(0,r.jsx)("div",{className:"line",children:(0,r.jsx)("i",{className:"fa fa-chevron-left"})}),(0,r.jsx)("span",{style:{minWidth:"50px"},children:g.S[d].neutral}),(0,r.jsx)("div",{className:"line",children:(0,r.jsx)("i",{className:"fa fa-chevron-right"})})]}),(0,r.jsx)("div",{className:"inline-flex",children:i[1]})]}),(0,r.jsx)("div",{className:"annotation-slider-container",children:Array.from({length:7},function(e,n){var a;return(0,r.jsx)("input",{className:"radio "+(n+1==f.suggestion?"radio-suggest":""),type:"checkbox",name:"annotationRadio_"+t,value:n+1,checked:(a=n+1)==f.observation||a==f.suggestion,onChange:function(e){changeHandler(e.target.value)}},n)})})]})})}function AnnotationForm(e){var n=e.x,t=e.y,o=e.pid,l=e.aid,d=e.annotation_id,u=e.annotation,m=(e.assignment,e.enable),f=e.show,v=e.close,_=e.save,N=e.remove,b=e.update,y=(0,s._)((0,c.useState)("en"),2),S=y[0],k=y[1],C=(0,s._)((0,c.useState)({x:n,y:t}),2),P=C[0],I=C[1],M=(0,s._)((0,c.useState)(!1),2),T=M[0],A=M[1],E=(0,s._)((0,c.useState)({x:0,y:0}),2),L=E[0],R=E[1],B=(0,s._)((0,c.useState)({}),2),F=B[0],D=B[1],H=(0,s._)((0,c.useState)(l),2),O=H[0],z=H[1],U=(0,s._)((0,c.useState)({1:!1,2:!1,3:!1,4:!1,5:!1,6:!1,7:!1,8:!1,9:!1}),2),Z=U[0],J=U[1],V=(0,s._)((0,c.useState)(null),2),X=V[0],q=V[1],G=(0,s._)((0,c.useState)({1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0}),2),W=G[0],K=G[1],Y=(0,s._)((0,c.useState)({10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0,25:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0}),2),$=Y[0],Q=Y[1],ee={1:["10","11"],2:["12","13"],3:["14","15"],4:["16","17","18"],5:["19","20","21"],6:["22","23"],7:["24","25","26","27"],8:["28","29","30"],9:["31","32"]},en={10:"1",11:"1",12:"2",13:"2",14:"3",15:"3",16:"4",17:"4",18:"4",19:"5",20:"5",21:"5",22:"6",23:"6",24:"7",25:"7",26:"7",27:"7",28:"8",29:"8",30:"8",31:"9",32:"9"},et=(0,s._)((0,c.useState)("annotation"),2),ea=et[0],ei=et[1],es=(0,s._)((0,c.useState)(!1),2),eo=es[0],er=es[1],showHideSubcategory=function(e){J((0,i._)((0,a._)({},Z),(0,h._)({},e,!Z[e])))},sliderChange=function(e,n){Q((0,i._)((0,a._)({},$),(0,h._)({},e,parseInt(n))))},closeAnnotation=function(){v(),resetAnnotation(),z(null),ei("annotation")},resetAnnotation=function(){if(m){var e=(0,a._)({},$);Object.keys(e).map(function(n,t){e[n]=0}),Q(e);var n=(0,a._)({},W);Object.keys(n).map(function(e,t){n[e]=0}),K(n);var t=(0,a._)({},Z);Object.keys(t).map(function(e,n){t[e]=!1}),J(t)}},saveAnnotation=function(e){m&&(u?b(u.cid,u.content.notes,W,$):_(window.items,W,$,function(n){n.message&&(e||alert("Annotate successfully!"),z(n.annotation_id))}))},onMouseMove=function(e){T&&I({x:e.clientX-L.x,y:e.clientY-L.y})},onMouseUp=function(){A(!1)},load_feedback_info=function(e){if(X){var n=[];Object.keys(W).map(function(e,t){n.push(X[e].cid)});var t={user_feedback_id:e,annotation_item_id:JSON.stringify(n)};(0,j.Vi)(t,function(e){var n=e.feedbacks;Object.keys(W).map(function(e,t){X[e].feedback=n[t]})})}};return(0,c.useEffect)(function(){if(f){if(u){var e=u.annot_items;q(e),z(u.cid);var n=u.content.annotations,t=(0,a._)({},Z);Object.keys(n).map(function(a,i){a in e?(e[a]>0&&(t[en[a]]=!0),n[a]=e[a]):n[a]=0}),Q((0,a._)({},$,n)),J(t);var i=u.content.annotations1;i&&(Object.keys(i).map(function(n,t){n in e?i[n]=e[n]:i[n]=0}),K((0,a._)({},W,i)))}else resetAnnotation()}},[f,u]),(0,c.useEffect)(function(){return T?(window.addEventListener("mousemove",onMouseMove),window.addEventListener("mouseup",onMouseUp)):(window.removeEventListener("mousemove",onMouseMove),window.removeEventListener("mouseup",onMouseUp)),function(){window.removeEventListener("mousemove",onMouseMove),window.removeEventListener("mouseup",onMouseUp)}},[T]),(0,c.useEffect)(function(){k((0,x.G3)());var e=(0,x.PR)();load_feedback_info(e.uid),D(e)},[]),(0,r.jsxs)("div",{className:"ui-block annotation-container "+(f?"":"hidden"),style:{top:P.y+"px",left:P.x+"px",cursor:T?"grabbing":"grab"},onMouseDown:function(e){R({x:e.clientX-P.x,y:e.clientY-P.y}),A(!0)},children:[(0,r.jsxs)("div",{className:"ui-block-title",children:[(0,r.jsxs)("div",{className:"row",children:[(0,r.jsx)("div",{className:"col col-4 annotation-tab "+("annotation"==ea?"active":""),children:(0,r.jsx)("button",{className:"btn btn-outline-dark",onClick:function(){ei("annotation")},children:(0,r.jsx)("i",{className:"far fa-list-music"})})}),(0,r.jsx)("div",{className:"col col-4 annotation-tab "+("comment"==ea?"active":""),children:(0,r.jsx)("button",{className:"btn btn-outline-dark",onClick:function(){ei("comment"),O||saveAnnotation(!0)},children:(0,r.jsx)("i",{className:"far fa-comment"})})}),(0,r.jsx)("div",{className:"col col-4 annotation-tab "+("voice"==ea?"active":""),children:(0,r.jsx)("button",{className:"btn btn-outline-dark",onClick:function(){ei("voice"),O||saveAnnotation(!0)},children:(0,r.jsx)("i",{className:"far fa-microphone"})})})]}),(0,r.jsx)("button",{className:"btn btn-primary close-button",onClick:closeAnnotation,children:(0,r.jsx)("i",{className:"fa fa-times"})})]}),(0,r.jsx)("div",{className:"annotation-scroll",children:(0,r.jsxs)("div",{className:"flex flex-wrap flex-col annotation-wrapper",children:["annotation"==ea&&["9","1","2","3","4","5","6","7","8"].map(function(e,n){var t=g.S[S][e],i=ee[e];return(0,r.jsxs)("div",{className:"annotation-item",children:[(0,r.jsxs)("div",{className:"annotation-item-head px-2 py-1 font-semibold "+(Z[e]?"annotation_selected":" "),onClick:function(){showHideSubcategory(e)},children:[(0,r.jsx)("div",{children:t}),(0,r.jsx)("div",{onClick:function(e){e.stopPropagation()},className:"flex",children:(0,r.jsx)(StarMetric,{id:"level-1",style:{width:"10.4px",height:"20px"},value:W[e],selectAction:function(n){if(m){var t=(0,a._)({},W);t[e]=n,K(t)}},enable:m})})]}),(0,r.jsx)("div",{className:"annotation-item-sub px-2 py-1 "+(Z[e]?" ":"hidden"),children:i.map(function(n,t){var a=g.S[S][n].split(" vs. ");return(0,r.jsx)("div",{className:"annotation-item-sub-wrapper "+("student"==F.user_type&&X&&X[n],""),children:(0,r.jsx)(Level2Scale,{enable:m,parentId:e,id:n,score:$[n],labels:a,onChange:sliderChange,annotation:u})},t)})})]},e)}),"comment"==ea&&O&&F.uid&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(w.Z,{type:"performance",pid:O,userId:F.uid,needCommentRefresh:eo,setNeedCommentRefresh:er}),(0,r.jsx)(p.Z,{user:F,pid:o,type:"performance",aid:O,onNewComment:function(){er(!0)}})]}),"voice"==ea&&O&&F.uid&&(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(voice_comment,{user:F,pid:o,aid:O,enable:!0})})]})}),"annotation"==ea&&(0,r.jsxs)("div",{className:"annotation-action row-flex",style:{justifyContent:"space-between"},children:[(0,r.jsxs)("div",{className:"annot-hint",children:[(0,r.jsx)("p",{className:"observation",children:(0,x.id)(S,"observation")}),(0,r.jsx)("p",{className:"suggestion",children:(0,x.id)(S,"suggestion")})]}),F.uid==d&&(0,r.jsxs)("div",{className:"flex-end "+ +(m?"":"hidden"),children:[(0,r.jsxs)("button",{className:"btn btn-outline-dark",onClick:resetAnnotation,children:[(0,r.jsx)("i",{className:"far fa-redo"}),"\xa0",(0,x.id)(S,"reset")]}),u&&(0,r.jsxs)("button",{className:"btn btn-outline-danger",onClick:function(){u&&(0,j.rT)(u.cid,function(){closeAnnotation(),N(u,u.cid)})},children:[(0,r.jsx)("i",{className:"far fa-trash"}),"\xa0",(0,x.id)(S,"delete")]}),(0,r.jsxs)("button",{className:"btn btn-outline-primary",onClick:function(){saveAnnotation(!1)},children:[(0,r.jsx)("i",{className:"far fa-save"}),"\xa0",(0,x.id)(S,"save")]})]})]})]})}var k=t(4827),C=t(6895),P=t(2452);function MidiPlayer(e){var n=e.url,a=e.title,i=e.id,o=e.isActive,l=e.offset,d=e.onPlay,m=e.onStop,f=e.onMove,h=e.onLoad,p=e.pageTracking,g=e.alignPage,w=e.userId,b=e.assignmentId,y=(0,c.useRef)(o),S=(0,c.useRef)(l),k=(0,c.useRef)(),C=(0,s._)((0,c.useState)({}),2),I=C[0],M=C[1],T=(0,s._)((0,c.useState)(!1),2),A=T[0],E=T[1],L=(0,s._)((0,c.useState)(!1),2),R=L[0],B=L[1],F=(0,s._)((0,c.useState)(!1),2),D=F[0],H=F[1],O=(0,s._)((0,c.useState)(null),2),z=O[0],U=O[1],Z=(0,s._)((0,c.useState)(null),2),J=Z[0],V=Z[1],X=(0,c.useRef)(null),q=(0,s._)((0,c.useState)(0),2),G=q[0],W=q[1],K=(0,s._)((0,c.useState)(0),2),Y=K[0],$=K[1],Q=(0,s._)((0,c.useState)(0),2),ee=Q[0],en=Q[1],et=(0,s._)((0,c.useState)(0),2),ea=et[0],ei=et[1],es=(0,s._)((0,c.useState)("00:00"),2),eo=es[0],er=es[1],ec=(0,s._)((0,c.useState)(null),2),el=ec[0],ed=ec[1],timeToString=function(e){var n=String(Math.floor(e/60)).padStart(2,"0"),t=String(Math.round(e%60)).padStart(2,"0");return"".concat(n,":").concat(t)},updateProgress=function(e){var n=e/Y*100;er(timeToString(e)),W(n)},checkProgressInterval=function(){en(setInterval(function(){var e=window.Tone.Transport.seconds;if(updateProgress(e),p&&g){var n=(0,x.ml)(p,e)-1;n>=0&&n<p.length&&n!=k.current&&(k.current=n,g(n))}e>=Y&&m()},100))},scheduleNotes=function(){window.Tone.Transport.cancel(0),z.tracks.forEach(function(e){e.notes.forEach(function(e){window.Tone.Transport.schedule(function(n){window.instrument.triggerAttackRelease(e.name,e.duration,n,e.velocity)},e.time)})})},playAction=function(){D&&!R&&(B(!0),scheduleNotes(),A?window.Tone.Transport.start():(E(!0),window.Tone.start().then(window.Tone.Transport.start())),ea>=Y?(ei(0),window.Tone.Transport.seconds=0):window.Tone.Transport.seconds=ea,checkProgressInterval())},resetTransport=function(){window.Tone.Transport.stop(),window.Tone.Transport.cancel(0)},stopAction=function(){B(!1),clearInterval(ee),ei(window.Tone.Transport.seconds),resetTransport()},stop=function(){m(),i||stopAction()},initPlayer=function(){t.e(149).then(t.bind(t,2149)).then(function(e){function _loadMidi(){return(_loadMidi=(0,_._)(function(n){var t,a,i;return(0,N.Jh)(this,function(s){switch(s.label){case 0:return[4,n.arrayBuffer()];case 1:return t=s.sent(),a=new P.Midi(t),window.instrument=new window.Tone.Sampler({urls:v.$d,release:1,baseUrl:"/mosaic/piano_files/"}).toDestination(),i=new e.Reverb({decay:2.5,wet:.3}).toDestination(),window.instrument.connect(i),a.tracks.forEach(function(e){if(e.controlChanges[64]){var n=[];e.controlChanges[64].forEach(function(e){e.value>0&&n.length%2==0?n.push(e.time):0==e.value&&n.length%2==1&&n.push(e.time)}),n.length&&e.notes.forEach(function(e){var t=(0,x.Nw)(n,e.time+e.duration);if(t<n.length&&t%2==1){var a=n[t]-e.time;e.duration=Math.max(e.duration,a)}})}}),$(a.duration),H(!0),U(a),h&&h(),[2]}})})).apply(this,arguments)}window.Tone=e,fetch(n).then(function(e){!function(e){_loadMidi.apply(this,arguments)}(e)}).catch(function(e){console.log(e)})})},getSubmissions=function(){w&&b&&(0,j.DA)(w,b,function(e){V(e),e.length>0&&ed(e[0].pid)})},selectVersion=function(e){u().push("/annotation?pid="+e.pid+"&aid="+e.aid)};return(0,c.useEffect)(function(){return M((0,x.PR)()),getSubmissions(),u().events.on("routeChangeStart",function(e){window.Tone&&stop()}),function(){u().events.off("routeChangeStart")}},[]),(0,c.useEffect)(function(){console.log("selectedPid updated:",el)},[el]),(0,c.useEffect)(function(){if(D||initPlayer(),o!==y.current&&(o?playAction():stopAction()),null!=l&&l!=S.current){var e=p[l];window.Tone.Transport.seconds=e,updateProgress(e),ei(e),l>=0&&l<p.length&&l!=k.current&&(k.current=l)}y.current=o,S.current=l},[o,l]),(0,r.jsxs)("div",{className:"ui-block",children:[(0,r.jsxs)("div",{className:"ui-block-title flex",style:{justifyContent:"space-between",padding:"10px 20px",alignItems:"center"},children:[(0,r.jsx)("a",{className:"h6",children:a}),(0,r.jsx)("div",{children:b&&J?(0,r.jsx)("fieldset",{className:"form-group",style:{margin:0,padding:"0px"},children:(0,r.jsx)("select",{className:"form-select",value:el,onChange:function(e){var n=e.target.value;ed(n),selectVersion({pid:n,aid:I.uid})},style:{padding:"10px 30px 10px 10px"},children:J.map(function(e,n){return(0,r.jsx)("option",{value:e.pid,children:e.updated_at},e.pid)})})}):(0,r.jsx)(r.Fragment,{})})]}),(0,r.jsx)("div",{className:"ui-block-content",children:(0,r.jsxs)("div",{className:"player-container flex row-flex ",children:[(0,r.jsx)("div",{className:"player-action inner-flex",children:R?(0,r.jsx)("button",{className:"btn btn-outline-primary",onClick:stop,children:(0,r.jsx)("i",{className:"fa fa-pause"})}):(0,r.jsx)("button",{className:"btn btn-outline-primary",onClick:function(){!D||R||(d(),i||playAction())},children:(0,r.jsx)("i",{className:"fa fa-play"})})}),(0,r.jsxs)("div",{className:"player-progress",ref:X,onClick:function(e){var n=(e.clientX-X.current.getBoundingClientRect().left)/X.current.offsetWidth;W(100*n);var t=n*Y;window.Tone.Transport.seconds=t,er(timeToString(t)),R||ei(t),f&&f(t)},children:[(0,r.jsx)("div",{className:"player-progress-bar",style:{width:"".concat(G,"%")}}),(0,r.jsx)("div",{className:"player-index",children:p&&Y?(0,r.jsx)(r.Fragment,{children:p.map(function(e,n){var t=e/Y*100;return(0,r.jsx)("div",{className:"player-index-tick",style:{left:t+"%"}},n)})}):(0,r.jsx)(r.Fragment,{})})]}),(0,r.jsxs)("div",{className:"player-time",children:[(0,r.jsx)("span",{children:eo}),"\xa0/\xa0",(0,r.jsx)("span",{children:timeToString(Y)})]})]})})]})}function PerformancePlayer(e){var n=e.url,t=e.title,a=e.userId,i=e.assignmentId,o=(0,s._)((0,c.useState)(null),2),l=o[0],d=o[1],m=(0,s._)((0,c.useState)(null),2),f=m[0],h=m[1],v=(0,s._)((0,c.useState)({}),2),p=v[0],g=v[1],getSubmissions=function(){a&&i&&(0,j.DA)(a,i,function(e){d(e),e.length>0&&h(e[0].pid)})},selectVersion=function(e){u().push("/annotation?pid="+e.pid+"&aid="+e.aid)};return(0,c.useEffect)(function(){g((0,x.PR)()),getSubmissions()},[]),(0,c.useEffect)(function(){console.log("selectedPid updated:",f)},[f]),(0,r.jsxs)("div",{className:"ui-block",children:[(0,r.jsxs)("div",{className:"ui-block-title flex",style:{justifyContent:"space-between",padding:"10px 20px",alignItems:"center"},children:[(0,r.jsx)("a",{className:"h6",children:t}),(0,r.jsx)("div",{children:i&&l?(0,r.jsx)("fieldset",{className:"form-group",style:{margin:0,padding:"0px"},children:(0,r.jsx)("select",{className:"form-select",value:f,onChange:function(e){var n=e.target.value;h(n),selectVersion({pid:n,aid:p.uid})},style:{padding:"10px 30px 10px 10px"},children:l.map(function(e,n){return(0,r.jsx)("option",{value:e.pid,children:e.updated_at},e.pid)})})}):(0,r.jsx)(r.Fragment,{})})]}),(0,r.jsx)("div",{className:"ui-block-content",children:(0,r.jsx)(SimpleAudioPlayer,{url:n})})]})}var I=t(6366);function AnnotationTooltip(e){var n=e.x,t=e.y,a=e.show;return(0,r.jsx)("div",{className:"annotation-tooltip",style:{top:t+"px",left:n+"px"},children:(0,r.jsx)("button",{className:"btn btn-outline-dark btn-tooltip",onClick:function(){a()},children:(0,r.jsx)("i",{className:"far fa-eye"})})})}function Annotation(){var e=(0,d.useRouter)(),n=(0,s._)((0,c.useState)("en"),2),u=n[0],m=n[1],h=(0,s._)((0,c.useState)(!1),2),v=h[0],p=h[1],g=(0,s._)((0,c.useState)({}),2),w=g[0],_=g[1],N=(0,l.useSearchParams)(),b=N.get("pid"),y=N.get("aid"),S=(0,s._)((0,c.useState)(!0),2),P=S[0];S[1];var M=(0,s._)((0,c.useState)(!1),2),T=M[0],A=M[1],E=(0,s._)((0,c.useState)(!1),2),L=E[0],R=E[1],B=(0,s._)((0,c.useState)(!1),2),F=B[0],D=B[1],H=(0,s._)((0,c.useState)(null),2),O=H[0],z=H[1],U=(0,s._)((0,c.useState)(1),2),Z=U[0],J=U[1],V=(0,s._)((0,c.useState)(null),2),X=V[0],q=V[1],G=(0,s._)((0,c.useState)(null),2),W=G[0],K=G[1],Y=(0,s._)((0,c.useState)(0),2),$=Y[0],Q=Y[1],ee=(0,s._)((0,c.useState)([]),2),en=ee[0],et=ee[1],ea=(0,s._)((0,c.useState)([]),2),ei=ea[0],es=ea[1],eo=(0,s._)((0,c.useState)(null),2),er=eo[0],ec=eo[1],el=(0,s._)((0,c.useState)(!1),2),ed=el[0],eu=el[1],em=(0,s._)((0,c.useState)(!1),2),ef=em[0],eh=em[1],ev=(0,s._)((0,c.useState)(null),2),ep=ev[0],ex=ev[1],eg=(0,s._)((0,c.useState)({}),2),ej=eg[0],ew=eg[1],e_=(0,s._)((0,c.useState)([]),2),eN=e_[0],eb=e_[1],ey=(0,s._)((0,c.useState)({}),2),eS=ey[0],ek=ey[1],eC=(0,s._)((0,c.useState)([]),2),eP=eC[0],eI=eC[1],eM=(0,c.useRef)(null),eT=(0,c.useRef)(null),eA=(0,s._)((0,c.useState)([]),2),eE=eA[0],eL=eA[1],eR=(0,s._)((0,c.useState)(null),2),eB=eR[0],eF=eR[1],eD=(0,s._)((0,c.useState)(y||""),2),eH=eD[0],eO=eD[1],visualizePage=function(e){p(!0);var n=W[e];eM.current.innerHTML=n,setPageAnnotations(eP,e),q(e),J(e+1),setTimeout(function(){updateSelection(),p(!1),window.startIndex&&window.endIndex&&highlightMeasureBetween(window.startIndex,window.endIndex)},200)},generateNext=function(){if(W&&X<$-1){var e=X+1;visualizePage(e),z(e)}},generatePrev=function(){if(W&&0!=X){var e=X-1;visualizePage(e),z(e)}},changePage=function(){var e=Z;(!e||e<1)&&(e=1),e>=$&&(e=$),J(e);var n=parseInt(e)-1;visualizePage(n),z(n)},buildMeasurePageMap=function(e,n,t){for(var a=0;a<e.length;a++)t[e[a].id]=n},renderBarPage=function(e){window.verovioToolkit.setOptions({scale:50,scaleToPageSize:!0,pageWidth:eT.current.getBoundingClientRect().width,pageHeight:1430}),window.verovioToolkit.loadData(e);var n=window.verovioToolkit.getPageCount();Q(n),q(0);for(var t=[],a=[1],i={},s=0;s<n;s++){var o=window.verovioToolkit.renderToSVG(s+1),r={measures:new DOMParser().parseFromString(o,"image/svg+xml").getElementsByClassName("measure")}.measures;a.push(a[a.length-1]+r.length),t.push(o),buildMeasurePageMap(r,s,i)}return K(t),es(a),ew(i),{svgs:t,measureTracking:a}},processStudentPerformance=function(e,n){var t=e.performance_onset,a=e.performance_measure;if(t&&a){for(var i=[],s=0;s<n.length-1;s++){var o=(0,x.Nw)(a,n[s]);a[o]==n[s]||a[o]>n[s]&&a[o]<n[s+1]?i.push(t[o]):0==s&&i.push(0)}et(i)}},updateSelection=function(){(0,x.PR)(),initSelection()},highlightMeasureBetween=function(e,n){if(e>n){var t=e;e=n,n=t}for(var a=[],i=e;i<=n;i++){a.push(window.measureIndexMap[i]);var s=document.getElementById(measureIndexMap[i]);s&&s.classList.add("selected")}window.items=a},normalizeMeasureBetween=function(e,n){if(e>n){var t=e;e=n,n=t}for(var a=e;a<=n;a++){var i=document.getElementById(window.measureIndexMap[a]);i&&(i.classList.remove("selected"),a==e&&i.classList.remove("annotated-start"),a==n&&i.classList.remove("annotated-end"))}window.items=[]},initSelection=function(){(0,x.PR)(),document.querySelectorAll(".measure").forEach(function(e){e.addEventListener("click",function(n){if("end"==window.selectState){if(window.startId){var t=document.getElementById(window.startId);t&&t.classList.remove("annotated-start")}window.startIndex&&window.endIndex&&normalizeMeasureBetween(window.startIndex,window.endIndex),window.startId=e.id;var a=window.measureMap[e.id];window.selectState="start",e.classList.add("annotated-start"),window.startIndex=a,window.endIndex=null,window.endId=null}else{if(window.endId){var i=document.getElementById(window.endId);i&&i.classList.remove("annotated-end")}window.endId=e.id;var s=window.measureMap[e.id];window.selectState="end",e.classList.add("annotated-end"),window.endIndex=s,highlightMeasureBetween(window.startIndex,window.endIndex)}})})},enableAnnotationBox=function(){eu(!0)},showAnnotationBox=function(e){window.items&&window.items.length&&(e.preventDefault(),ex(null),eh(!0),enableAnnotationBox())},insertAnnotationLocal=function(e,n,t,i,s,r){var c={user_id:w.uid,access_control:1,avatar:w.avatar,cid:e,start_bar:n,end_bar:t,content:i,annot_items:(0,a._)({},s,r)};eI(function(e){return(0,o._)(e).concat([c])}),eb(function(e){return(0,o._)(e).concat([c])})},focusAnnotation=function(e,n){for(var t=e.content.notes,a=0;a<t.length;a++){var i=document.getElementById(t[a]);i&&i.classList.add("annotated")}},unFocusAnnotation=function(e){for(var n=e.content.notes,t=0;t<n.length;t++){var a=document.getElementById(n[t]);a&&a.classList.remove("annotated")}},getAnnotationPosition=function(e){var n=eT.current.getBoundingClientRect(),t=document.getElementById(e),a={x:0,y:0};if(t){var i=t.getBoundingClientRect();a={x:i.x-n.x+(0,x.xT)(0,200),y:i.y-n.y-30-(0,x.xT)(0,30)}}return a},loadPerformanceData=function(){var buildMeasureMap=function(e){for(var n={},t={},a=0;a<e.length;a++)n[e[a]]=a+1,t[a+1]=e[a];window.measureMap=n,window.measureIndexMap=t},init=function(e,n){if((0,x.PR)(),eh(!0),n){var t=renderBarPage(n);eM.current.innerHTML=t.svgs[0],initSelection(),R(!0),ek(e),"MIDI"!=(0,x.JB)(e.performance_midi_path)&&A(!0),processStudentPerformance(e,t.measureTracking)}e.assignment&&e.assignment.class_id&&eF(e.assignment.class_id)};(0,j.X9)(b,function(e){e.part_id?(0,j.CE)(e.part_id,function(n){buildMeasureMap(n.measures),init(e,n.data)}):(0,j.kd)(e.song_id,function(n){buildMeasureMap(n.measures),init(e,n.data)})})},setPageAnnotations=function(e,n){for(var t=[],a=0;a<e.length;a++){var i=e[a].content.notes;i.length&&ej.hasOwnProperty(i[0])&&(ej[i[0]]==n?t.push(e[a]):i.length>1&&ej[i[i.length-1]]==n&&t.push(e[a]))}eb(t)};(0,c.useEffect)(function(){P&&T&&L&&((0,j.h)(b,y,function(e){eI(e),setPageAnnotations(e,0)}),p(!1))},[b,y,P,T,L]),(0,c.useEffect)(function(){m((0,x.G3)()),window.selectState="end",window.startIndex=null,window.endIndex=null,window.startId=null,window.endId=null,window.measureMap=null,window.measureIndexMap=null,ec({x:window.innerWidth/2-300,y:window.innerHeight/2-263}),b&&(p(!0),_((0,x.PR)()),window.verovio?(window.verovioToolkit=new window.verovio.toolkit,loadPerformanceData()):Promise.all([t.e(752),t.e(714),t.e(817),t.e(565)]).then(t.t.bind(t,393,23)).then(function(e){window.verovio=e;var n=setInterval(function(){try{window.verovioToolkit=new window.verovio.toolkit,clearInterval(n),loadPerformanceData()}catch(e){}},50)}),P&&T&&L&&p(!1))},[]),(0,c.useEffect)(function(){eB&&(console.log("Fetching students for class ID:",eB),fetchClassStudents())},[eB]);var fetchClassStudents=function(){(0,j.KD)(eB,function(e){console.log("Students data:",e),eL(e)})};return(0,c.useEffect)(function(){if(eE.length>0&&!eH){var n=eE[0].user_id;eO(n),e.push({pathname:e.pathname,query:(0,i._)((0,a._)({},e.query),{aid:n})})}},[eE,eH]),(0,r.jsxs)("div",{className:"annotation-page",children:[(0,r.jsx)("div",{className:"loading",style:v?{display:"flex"}:{display:"none"},children:(0,r.jsx)("img",{src:"svg-icons/spinner.svg"})}),(0,r.jsx)(k.Z,{title:"Performance",css:{position:"absolute"}}),(0,r.jsx)("div",{className:"header-spacer"}),(0,r.jsx)("div",{className:"explanation-container",children:(0,r.jsxs)("div",{className:"fix-left-container",children:[(0,r.jsxs)("div",{className:"row",children:[(0,r.jsx)("div",{className:"col col-xl-4 col-lg-4 col-md-4 col-sm-12 col-12",children:(0,r.jsx)("div",{className:"ui-block",children:(0,r.jsxs)("div",{className:"ui-block-title row-flex",children:[(0,r.jsx)("div",{className:"author-thumb inline-flex",children:(0,r.jsx)("div",{className:"icon",children:(0,r.jsx)("i",{className:"far fa-users-class"})})}),(0,r.jsxs)("div",{className:"inline-flex annotation-title-content",children:[(0,r.jsx)("a",{className:"h6",children:(0,x.id)(u,"class_information")}),eS.assignment?(0,r.jsx)("div",{children:eS.assignment.classname}):(0,r.jsx)("div",{children:(0,x.id)(u,"no_information")})]})]})})}),(0,r.jsx)("div",{className:"col col-xl-4 col-lg-4 col-md-4 col-sm-12 col-12",children:(0,r.jsx)("div",{className:"ui-block",children:(0,r.jsxs)("div",{className:"ui-block-title row-flex",children:[(0,r.jsx)("div",{className:"author-thumb inline-flex",children:(0,r.jsx)("div",{className:"icon",children:(0,r.jsx)("i",{className:"far fa-tasks"})})}),(0,r.jsxs)("div",{className:"inline-flex annotation-title-content",children:[(0,r.jsx)("a",{className:"h6",children:(0,x.id)(u,"assignment_information")}),eS.assignment?(0,r.jsx)("div",{children:eS.assignment.name}):(0,r.jsx)("div",{children:(0,x.id)(u,"no_information")})]})]})})}),(0,r.jsx)("div",{className:"col col-xl-4 col-lg-4 col-md-4 col-sm-12 col-12",children:(0,r.jsx)("div",{className:"ui-block",children:(0,r.jsxs)("div",{className:"ui-block-title row-flex",children:[(0,r.jsx)("div",{className:"author-thumb inline-flex",children:(0,r.jsx)("div",{className:"author-thumb",children:(0,r.jsx)(f(),{href:"/profile?uid="+eS.user_id,children:eS.avatar?(0,r.jsx)("img",{loading:"lazy",src:eS.avatar,alt:"photo",width:"36",height:"36"}):(0,r.jsx)("img",{loading:"lazy",src:"img/avatar1.webp",alt:"photo",width:"36",height:"36"})})})}),(0,r.jsxs)("div",{className:"inline-flex annotation-title-content",children:[(0,r.jsx)("a",{className:"h6",children:(0,x.id)(u,"performer_name")}),(0,r.jsx)("div",{children:(0,r.jsx)(f(),{href:"/profile?uid="+eS.user_id,children:eS.fullname})})]})]})})})]}),(0,r.jsx)("div",{className:"row",children:(0,r.jsx)("div",{className:"col col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12",children:eS&&eS.performance_midi_path?(0,r.jsx)(r.Fragment,{children:"MIDI"!=(0,x.JB)(eS.performance_midi_path)?(0,r.jsx)(PerformancePlayer,{url:eS.performance_midi_path,title:eS.name+"-"+eS.updated_at+(eS.start_bar?" (Measures:"+eS.start_bar+"-"+eS.end_bar+")":""),userId:eS.user_id,assignmentId:eS.assignment_id}):(0,r.jsx)(MidiPlayer,{url:eS.performance_midi_path,title:eS.name+"-"+eS.updated_at+(eS.start_bar?" (Measures:"+eS.start_bar+"-"+eS.end_bar+")":""),id:"performance_midi",offset:O,isActive:"performance_midi"==F,onPlay:function(){return D("performance_midi")},onStop:function(){return D(null)},onLoad:function(){A(!0)},onMove:function(e){var n=eS.performance_onset;if(n){var t=(0,x.ml)(n,e);if(n[t]==e&&(t-=1),!(t>=eS.performance_measure.length)){var a=parseInt(eS.performance_measure[t]);if(isNaN(a)||a<0)for(;--t&&(isNaN(a=parseInt(eS.performance_measure[t]))||!(a>0)););visualizePage((0,x.ml)(ei,a)-1)}}},pageTracking:en,alignPage:visualizePage,userId:eS.user_id,assignmentId:eS.assignment_id})}):(0,r.jsx)(r.Fragment,{})})})]})}),(0,r.jsx)("div",{className:"explanation-container",children:(0,r.jsx)("div",{className:"fix-left-container",ref:eT,style:{minHeight:"1530px",marginBottom:"30px"},children:(0,r.jsxs)("div",{className:"bar_container selectable",id:"barContainer",onContextMenu:showAnnotationBox,onTouchStart:function(e){2==e.touches.length&&showAnnotationBox(e)},style:{height:"1530px"},children:[(0,r.jsx)("div",{className:"level0-container"}),(0,r.jsx)("div",{className:"mode-switch",children:(0,r.jsx)("select",{onChange:function(n){var t=n.target.value;t&&(eO(t),e.push({pathname:e.pathname,query:(0,i._)((0,a._)({},e.query),{aid:t})})),console.log("Selected student ID:",t)},value:eH,children:eE.map(function(e){return(0,r.jsxs)("option",{value:e.user_id,children:[e.fullname?e.fullname:e.username," "]},e.user_id)})})}),(0,r.jsx)("button",{className:"btn btn-outline-primary bar_nav_bt "+($>1?"show":""),onClick:generatePrev,children:(0,r.jsx)("i",{className:"fa fa-chevron-left"})}),(0,r.jsx)("button",{className:"btn btn-outline-primary bar_nav_bt bar_nav_bt_right "+($>1?"show":""),onClick:generateNext,children:(0,r.jsx)("i",{className:"fa fa-chevron-right"})}),(0,r.jsx)("div",{ref:eM}),(0,r.jsx)("div",{className:"bar-pagination-wrapper "+(v?"hidden":""),children:(0,r.jsxs)("div",{className:"bar-pagination",children:[(0,r.jsx)("button",{className:"btn btn-outline-primary "+($<=1?"hidden":""),onClick:generatePrev,children:(0,r.jsx)("i",{className:"fa fa-chevron-left"})}),(0,r.jsx)("input",{className:"bar-pagination-item",value:Z,type:"number",onChange:function(e){J(e.target.value)},onKeyDown:function(e){"Enter"==e.key&&changePage()}}),(0,r.jsx)("div",{className:"bar-pagination-slash",children:(0,r.jsx)("div",{children:"/"})}),(0,r.jsx)("div",{className:"bar-pagination-item",children:(0,r.jsx)("div",{children:$})}),(0,r.jsx)("button",{className:"btn btn-outline-primary "+($<=1?"hidden":""),onClick:generateNext,children:(0,r.jsx)("i",{className:"fa fa-chevron-right"})})]})}),(0,r.jsx)("div",{className:"annotation-overlay-container",children:0!=eN.length&&eN.map(function(e,n){e.expanded=!1;var t=e.content.notes,a={x:0,y:0},i=ej[t[0]];return i!=X?(i=X,a=getAnnotationPosition(t[t.length-1])):a=getAnnotationPosition(t[0]),(0,r.jsx)(AnnotationTooltip,{x:a.x,y:a.y,show:function(){ex(e),eu(!0),focusAnnotation(e,i)}},e.cid)})})]})})}),b,w&&er&&eS&&eS.assignment?(0,r.jsx)(AnnotationForm,{x:er.x,y:er.y,pid:b,annotation_id:y,annotation:ep,assignment:eS.assignment,show:ed,enable:ef,close:function(){eu(!1),ex(null),window.items&&(window.items=[]),window.startIndex&&window.endIndex&&normalizeMeasureBetween(window.startIndex,window.endIndex)},save:function(e,n,t,a){var i=e[0],s=e[e.length-1],o={notes:e,annotations1:n,annotations:t},r=(0,x.VN)();(0,j.Iy)(b,r,JSON.stringify(o),i,s,function(e){insertAnnotationLocal(e.annotation_id,i,s,o,n,t),a(e)})},update:function(e,n,t,i){var updateList=function(e,n,t){var a=e.findIndex(function(e){return e.cid==n.cid});if(-1!=a){var i=(0,o._)(e);i[a]=n,t(i)}},s={notes:n,annotations1:t,annotations:i};(0,j.U1)(e,JSON.stringify(s),function(e){if(e.message){alert("Update successfully!");var n=(0,a._)({},t,i),o=(0,a._)({},ep);o.annot_items=n,o.content=s,updateList(eN,o,eb),updateList(eP,o,eI)}})},remove:function(e,n){unFocusAnnotation(e),eb(eN.filter(function(e){return e.cid!=n}))}}):(0,r.jsx)(r.Fragment,{}),(0,r.jsx)(I.Z,{}),(0,r.jsx)(C.Z,{pageNum:4})]})}}},function(e){e.O(0,[571,424,332,668,980,774,888,179],function(){return e(e.s=223)}),_N_E=e.O()}]);